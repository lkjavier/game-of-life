<!DOCTYPE HTML>
<html lang="en">
    <head>
        <style>
            table, th, td {
                border: 1px solid black
            }
            td {
                height: 15px;
                width:  15px
            }
            .buttons {
                width: 150px;
                height: 50px;
                background-color: green;
            }
        </style>
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        <script>
                
                window.onload = function(){
                    window.$v = new Vue({
                        el: "#cellgrid",
                        methods: {
                            advance_s: function(){
                                socket.emit('Call', JSON.stringify(this.current_state));
                                
                            },
                            advance: function(current_state){
                                        fetch('http://localhost:5000/advance', {
                                            method: 'POST',
                                            headers: {
                                                'content-type': 'application/json' 
                                            },
                                            body: JSON.stringify(current_state)
                                        }).then(
                                            data => data.json()
                                        ).catch(error => console.error(error)
                                        ).then(response => this.current_state = response);
                                        
                            },
                            toggle_cell: function(row, cell, value){
                                console.log(row + ", " + cell );
                                this.current_state[row][cell] = value === 0 ? 1 : 0; 
                                this.$forceUpdate();
                            },
                            advance_n: function(current_state, n, scope = this){
                                let timerId = setTimeout(function n(){
                                    scope.advance(current_state); 
                                    scope.$forceUpdate();
                                    timerId = setTimeout(n, 2000, scope);
                                }, 2000);
                                setTimeout(() => clearInterval(timerId), n*20000);
                            },

                        },
                        data: {
                            current_state: {{ state }},
                        } ,
                    
                    });
                };
                
            </script>
    </head>
    <body> 
    <div id="cellgrid">
    <div>
        <table>
           <tr v-for="(row, row_index) in current_state">
                <td v-for="(cell, cell_index) in row" v-bind:style="[cell === 0 ? { 'background-color': 'white'} : { 'background-color': 'black'}]" 
                    v-on:click="toggle_cell(row_index, cell_index, cell)"></td>
            </tr>
        </table>
    </div>
    <div id="advance_button" class="buttons" v-on:click="advance_s(current_state)">

    </div>
    </div>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
    <script type="text/javascript" charset="utf-8">
        var socket = io.connect('http://' + document.domain + ':' + location.port);
        socket.on('connect', function() {
            //socket.emit('Call', {data: 'CallData'});
        });
        socket.on('Response', function(data){
            $v.current_state = JSON.parse(data);
            console.log(typeof data);

        });
</script>
    </body>
</html>